/**
 * MIT License
 * 
 * Copyright (c) 2020 动中之动
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */

import{v as t,s as r,T as e}from"../Task-f41dffa5.js";import{_ as n,S as i,i as o}from"../Subscriber-4bc9607d.js";import{m as s}from"../map-39ac3b74.js";import{p as a}from"../subscribeTo-a0871bd2.js";import{f as c}from"../from-d10c21fa.js";import"./components.js";import"../utils/type.js";function p(){}var u=function(){function t(t){this.predicate=t}return t.prototype.call=function(t,r){return r.subscribe(new l(t,this.predicate))},t}(),l=function(t){function r(r,e){var n=t.call(this,r)||this;return n.predicate=e,n.skipping=!0,n.index=0,n}return n(r,t),r.prototype._next=function(t){var r=this.destination;this.skipping&&this.tryCallPredicate(t),this.skipping||r.next(t)},r.prototype.tryCallPredicate=function(t){try{var r=this.predicate(t,this.index++);this.skipping=Boolean(r)}catch(t){this.destination.error(t)}},r}(i);function h(t,r,e){return function(n){return n.lift(new f(t,r,e))}}var f=function(){function t(t,r,e){this.nextOrObserver=t,this.error=r,this.complete=e}return t.prototype.call=function(t,r){return r.subscribe(new d(t,this.nextOrObserver,this.error,this.complete))},t}(),d=function(t){function r(r,e,n,i){var s=t.call(this,r)||this;return s._tapNext=p,s._tapError=p,s._tapComplete=p,s._tapError=n||p,s._tapComplete=i||p,o(e)?(s._context=s,s._tapNext=e):e&&(s._context=e,s._tapNext=e.next||p,s._tapError=e.error||p,s._tapComplete=e.complete||p),s}return n(r,t),r.prototype._next=function(t){try{this._tapNext.call(this._context,t)}catch(t){return void this.destination.error(t)}this.destination.next(t)},r.prototype._error=function(t){try{this._tapError.call(this._context,t)}catch(t){return void this.destination.error(t)}this.destination.error(t)},r.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(t){return void this.destination.error(t)}return this.destination.complete()},r}(i);function m(t,r,e,n){switch(t){case 0:return r&e^~r&n;case 1:return r^e^n;case 2:return r&e^r&n^e&n;case 3:return r^e^n}}function _(t,r){return t<<r|t>>>32-r}var y=function(e,n,i){function o(e,o,s,a){if("string"==typeof e&&(e=function(t){t=unescape(encodeURIComponent(t));for(var r=[],e=0;e<t.length;++e)r.push(t.charCodeAt(e));return r}(e)),"string"==typeof o&&(o=function(r){if(!t(r))throw TypeError("Invalid UUID");var e,n=new Uint8Array(16);return n[0]=(e=parseInt(r.slice(0,8),16))>>>24,n[1]=e>>>16&255,n[2]=e>>>8&255,n[3]=255&e,n[4]=(e=parseInt(r.slice(9,13),16))>>>8,n[5]=255&e,n[6]=(e=parseInt(r.slice(14,18),16))>>>8,n[7]=255&e,n[8]=(e=parseInt(r.slice(19,23),16))>>>8,n[9]=255&e,n[10]=(e=parseInt(r.slice(24,36),16))/1099511627776&255,n[11]=e/4294967296&255,n[12]=e>>>24&255,n[13]=e>>>16&255,n[14]=e>>>8&255,n[15]=255&e,n}(o)),16!==o.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var c=new Uint8Array(16+e.length);if(c.set(o),c.set(e,o.length),(c=i(c))[6]=15&c[6]|n,c[8]=63&c[8]|128,s){a=a||0;for(var p=0;p<16;++p)s[a+p]=c[p];return s}return r(c)}try{o.name=e}catch(t){}return o.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",o.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",o}("v5",80,(function(t){var r=[1518500249,1859775393,2400959708,3395469782],e=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof t){var n=unescape(encodeURIComponent(t));t=[];for(var i=0;i<n.length;++i)t.push(n.charCodeAt(i))}else Array.isArray(t)||(t=Array.prototype.slice.call(t));t.push(128);for(var o=t.length/4+2,s=Math.ceil(o/16),a=new Array(s),c=0;c<s;++c){for(var p=new Uint32Array(16),u=0;u<16;++u)p[u]=t[64*c+4*u]<<24|t[64*c+4*u+1]<<16|t[64*c+4*u+2]<<8|t[64*c+4*u+3];a[c]=p}a[s-1][14]=8*(t.length-1)/Math.pow(2,32),a[s-1][14]=Math.floor(a[s-1][14]),a[s-1][15]=8*(t.length-1)&4294967295;for(var l=0;l<s;++l){for(var h=new Uint32Array(80),f=0;f<16;++f)h[f]=a[l][f];for(var d=16;d<80;++d)h[d]=_(h[d-3]^h[d-8]^h[d-14]^h[d-16],1);for(var y=e[0],g=e[1],v=e[2],U=e[3],b=e[4],x=0;x<80;++x){var I=Math.floor(x/20),w=_(y,5)+m(I,g,v,U)+b+r[I]+h[x]>>>0;b=U,U=v,v=_(g,30)>>>0,g=y,y=w}e[0]=e[0]+y>>>0,e[1]=e[1]+g>>>0,e[2]=e[2]+v>>>0,e[3]=e[3]+U>>>0,e[4]=e[4]+b>>>0}return[e[0]>>24&255,e[0]>>16&255,e[0]>>8&255,255&e[0],e[1]>>24&255,e[1]>>16&255,e[1]>>8&255,255&e[1],e[2]>>24&255,e[2]>>16&255,e[2]>>8&255,255&e[2],e[3]>>24&255,e[3]>>16&255,e[3]>>8&255,255&e[3],e[4]>>24&255,e[4]>>16&255,e[4]>>8&255,255&e[4]]}));export default class{constructor(...t){this.plugins=t,this._createPipeline()}marksPath=[];plugins=[];_aboutElementIndex=-1;_status="normal";_tasks=[];_pluginsUUID;_createUUID(t){return y(t,y.URL)}_createPipeline(){let t=[],r=this.plugins.reduce(((r,e)=>{let n=e.toString(),i=this._createUUID(n);return e.uuid=i,t.push(n),!1===e.$canSkip?r.push(e):r.push((function(t){let r,n=t.pipe(h((t=>r=t.$checkRepeat(i))));return r?n:n.pipe(e)}),s((t=>(t.$Mark(i),t)))),r}),[]);this._pluginsUUID=this._createUUID(JSON.stringify(t)),console.log(this._pluginsUUID),this.pipeline=a(...r)}apply(t){return console.log("开始流",t),c(t).pipe(s((t=>{const r=new e(t,this._pluginsUUID);return this._tasks.push(r),r})),(r=t=>!(!t._complete||"complete"!==t._status||t._completeUUID!==this._pluginsUUID||(console.log("跳过一个目标"),0)),function(t){return t.lift(new u(r))}),this.pipeline,h((t=>t.$commit("complete",this._pluginsUUID)))).subscribe({complete(){console.log("爬虫全部完成")}});var r}setting(){}restart(){}retry(){}about(){}report(t){}}
