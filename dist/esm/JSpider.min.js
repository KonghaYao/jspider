/**
 * MIT License
 * 
 * Copyright (c) 2020 动中之动
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */

/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};function e(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}function r(t,e,r,n){return new(r||(r=Promise))((function(o,i){function u(t){try{s(n.next(t))}catch(t){i(t)}}function c(t){try{s(n.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(u,c)}s((n=n.apply(t,e||[])).next())}))}function n(t,e){var r,n,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,n=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=u.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=e.call(t,u)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}function o(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function i(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,o,i=r.call(t),u=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)u.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return u}function u(t,e){for(var r=0,n=e.length,o=t.length;r<n;r++,o++)t[o]=e[r];return t}function c(t){return this instanceof c?(this.v=t,this):new c(t)}function s(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,o=r.apply(t,e||[]),i=[];return n={},u("next"),u("throw"),u("return"),n[Symbol.asyncIterator]=function(){return this},n;function u(t){o[t]&&(n[t]=function(e){return new Promise((function(r,n){i.push([t,e,r,n])>1||s(t,e)}))})}function s(t,e){try{(r=o[t](e)).value instanceof c?Promise.resolve(r.value.v).then(a,l):f(i[0][2],r)}catch(t){f(i[0][3],t)}var r}function a(t){s("next",t)}function l(t){s("throw",t)}function f(t,e){t(e),i.shift(),i.length&&s(i[0][0],i[0][1])}}function a(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,r=t[Symbol.asyncIterator];return r?r.call(t):(t=o(t),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(r){e[r]=t[r]&&function(e){return new Promise((function(n,o){(function(t,e,r,n){Promise.resolve(n).then((function(e){t({value:e,done:r})}),e)})(n,o,(e=t[r](e)).done,e.value)}))}}}function l(t){return"function"==typeof t}var f,p=((f=function(t){return function(e){t(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e}}((function(t){Error.call(t),t.stack=(new Error).stack}))).prototype=Object.create(Error.prototype),f.prototype.constructor=f,f);function h(t,e){if(t){var r=t.indexOf(e);0<=r&&t.splice(r,1)}}var d=function(){function t(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._teardowns=null}var e;return t.prototype.unsubscribe=function(){var t,e,r,n,c;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var a=o(s),f=a.next();!f.done;f=a.next()){f.value.remove(this)}}catch(e){t={error:e}}finally{try{f&&!f.done&&(e=a.return)&&e.call(a)}finally{if(t)throw t.error}}else s.remove(this);var h=this.initialTeardown;if(l(h))try{h()}catch(t){c=t instanceof p?t.errors:[t]}var d=this._teardowns;if(d){this._teardowns=null;try{for(var y=o(d),b=y.next();!b.done;b=y.next()){var _=b.value;try{v(_)}catch(t){c=null!=c?c:[],t instanceof p?c=u(u([],i(c)),i(t.errors)):c.push(t)}}}catch(t){r={error:t}}finally{try{b&&!b.done&&(n=y.return)&&n.call(y)}finally{if(r)throw r.error}}}if(c)throw new p(c)}},t.prototype.add=function(e){var r;if(e&&e!==this)if(this.closed)v(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._teardowns=null!==(r=this._teardowns)&&void 0!==r?r:[]).push(e)}},t.prototype._hasParent=function(t){var e=this._parentage;return e===t||Array.isArray(e)&&e.includes(t)},t.prototype._addParent=function(t){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t},t.prototype._removeParent=function(t){var e=this._parentage;e===t?this._parentage=null:Array.isArray(e)&&h(e,t)},t.prototype.remove=function(e){var r=this._teardowns;r&&h(r,e),e instanceof t&&e._removeParent(this)},t.EMPTY=((e=new t).closed=!0,e),t}();function y(t){return t instanceof d||t&&"closed"in t&&l(t.remove)&&l(t.add)&&l(t.unsubscribe)}function v(t){l(t)?t():t.unsubscribe()}var b={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},_=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return setTimeout.apply(void 0,u([],i(t)))};function m(t){_((function(){throw t}))}function w(){}var g=function(t){function r(e){var r=t.call(this)||this;return r.isStopped=!1,e?(r.destination=e,y(e)&&e.add(r)):r.destination=S,r}return e(r,t),r.create=function(t,e,r){return new j(t,e,r)},r.prototype.next=function(t){this.isStopped||this._next(t)},r.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},r.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},r.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},r.prototype._next=function(t){this.destination.next(t)},r.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},r.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},r}(d),j=function(t){function r(e,r,n){var o,i=t.call(this)||this;if(l(e))o=e;else if(e){var u;o=e.next,r=e.error,n=e.complete,i&&b.useDeprecatedNextContext?(u=Object.create(e)).unsubscribe=function(){return i.unsubscribe()}:u=e,o=null==o?void 0:o.bind(u),r=null==r?void 0:r.bind(u),n=null==n?void 0:n.bind(u)}return i.destination={next:o?x(o):w,error:x(null!=r?r:O),complete:n?x(n):w},i}return e(r,t),r}(g);function x(t,e){return function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];try{t.apply(void 0,u([],i(e)))}catch(t){m(t)}}}function O(t){throw t}var S={closed:!0,next:w,error:O,complete:w},k="function"==typeof Symbol&&Symbol.observable||"@@observable";function U(t){return t}function A(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return I(t)}function I(t){return 0===t.length?U:1===t.length?t[0]:function(e){return t.reduce((function(t,e){return e(t)}),e)}}var P=function(){function t(t){t&&(this._subscribe=t)}return t.prototype.lift=function(e){var r=new t;return r.source=this,r.operator=e,r},t.prototype.subscribe=function(t,e,r){var n,o=(n=t)&&n instanceof g||function(t){return t&&l(t.next)&&l(t.error)&&l(t.complete)}(n)&&y(n)?t:new j(t,e,r),i=this.operator,u=this.source;return o.add(i?i.call(o,u):u?this._subscribe(o):this._trySubscribe(o)),o},t.prototype._deprecatedSyncErrorSubscribe=function(t){var e=t;e._syncErrorHack_isSubscribing=!0;var r=this.operator;if(r)t.add(r.call(t,this.source));else try{t.add(this._subscribe(t))}catch(t){e.__syncError=t}for(var n=e;n;){if("__syncError"in n)try{throw n.__syncError}finally{t.unsubscribe()}n=n.destination}e._syncErrorHack_isSubscribing=!1},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.error(e)}},t.prototype.forEach=function(t,e){var r=this;return new(e=E(e))((function(e,n){var o;o=r.subscribe((function(e){try{t(e)}catch(t){n(t),null==o||o.unsubscribe()}}),n,e)}))},t.prototype._subscribe=function(t){var e;return null===(e=this.source)||void 0===e?void 0:e.subscribe(t)},t.prototype[k]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.length?I(t)(this):this},t.prototype.toPromise=function(t){var e=this;return new(t=E(t))((function(t,r){var n;e.subscribe((function(t){return n=t}),(function(t){return r(t)}),(function(){return t(n)}))}))},t.create=function(e){return new t(e)},t}();function E(t){var e;return null!==(e=null!=t?t:b.Promise)&&void 0!==e?e:Promise}function $(t){return function(e){if(function(t){return l(null==t?void 0:t.lift)}(e))return e.lift((function(e){try{return t(e,this)}catch(t){this.error(t)}}));throw new TypeError("Unable to lift unknown Observable type")}}var T=function(t){function r(e,r,n,o,i){var u=t.call(this,e)||this;return u.onFinalize=i,u._next=r?function(t){try{r(t)}catch(t){e.error(t)}}:t.prototype._next,u._error=o?function(t){try{o(t)}catch(t){e.error(t)}finally{this.unsubscribe()}}:t.prototype._error,u._complete=n?function(){try{n()}catch(t){e.error(t)}finally{this.unsubscribe()}}:t.prototype._complete,u}return e(r,t),r.prototype.unsubscribe=function(){var e,r=this.closed;t.prototype.unsubscribe.call(this),!r&&(null===(e=this.onFinalize)||void 0===e||e.call(this))},r}(g),D=function(){return Date.now()},R=function(t){function r(e,r){return t.call(this)||this}return e(r,t),r.prototype.schedule=function(t,e){return this},r}(d),z=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return setInterval.apply(void 0,u([],i(t)))},M=function(t){return clearInterval(t)},F=function(t){function r(e,r){var n=t.call(this,e,r)||this;return n.scheduler=e,n.work=r,n.pending=!1,n}return e(r,t),r.prototype.schedule=function(t,e){if(void 0===e&&(e=0),this.closed)return this;this.state=t;var r=this.id,n=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(n,r,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(n,this.id,e),this},r.prototype.requestAsyncId=function(t,e,r){return void 0===r&&(r=0),z(t.flush.bind(t,this),r)},r.prototype.recycleAsyncId=function(t,e,r){if(void 0===r&&(r=0),null!=r&&this.delay===r&&!1===this.pending)return e;M(e)},r.prototype.execute=function(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var r=this._execute(t,e);if(r)return r;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},r.prototype._execute=function(t,e){var r,n=!1;try{this.work(t)}catch(t){n=!0,r=!!t&&t||new Error(t)}if(n)return this.unsubscribe(),r},r.prototype.unsubscribe=function(){if(!this.closed){var e=this.id,r=this.scheduler,n=r.actions;this.work=this.state=this.scheduler=null,this.pending=!1,h(n,this),null!=e&&(this.id=this.recycleAsyncId(r,e,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},r}(R),L=function(){function t(e,r){void 0===r&&(r=t.now),this.schedulerActionCtor=e,this.now=r}return t.prototype.schedule=function(t,e,r){return void 0===e&&(e=0),new this.schedulerActionCtor(this,t).schedule(r,e)},t.now=D,t}(),C=new(function(t){function r(e,r){void 0===r&&(r=L.now);var n=t.call(this,e,r)||this;return n.actions=[],n._active=!1,n._scheduled=void 0,n}return e(r,t),r.prototype.flush=function(t){var e=this.actions;if(this._active)e.push(t);else{var r;this._active=!0;do{if(r=t.execute(t.state,t.delay))break}while(t=e.shift());if(this._active=!1,r){for(;t=e.shift();)t.unsubscribe();throw r}}},r}(L))(F),N=C,B=new P((function(t){return t.complete()}));function H(t,e){return new P((function(r){var n=0;return e.schedule((function(){n===t.length?r.complete():(r.next(t[n++]),r.closed||this.schedule())}))}))}var J=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t};function X(t){return l(null==t?void 0:t.then)}var V="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function q(t,e){if(!t)throw new Error("Iterable cannot be null");return new P((function(r){var n=new d;return n.add(e.schedule((function(){var o=t[Symbol.asyncIterator]();n.add(e.schedule((function(){var t=this;o.next().then((function(e){e.done?r.complete():(r.next(e.value),t.schedule())}))})))}))),n}))}function G(t){return l(t[k])}function Y(t){return l(null==t?void 0:t[V])}function W(t){return Symbol.asyncIterator&&l(null==t?void 0:t[Symbol.asyncIterator])}function K(t){return new TypeError("You provided "+(null!==t&&"object"==typeof t?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function Q(t){return s(this,arguments,(function(){var e,r,o;return n(this,(function(n){switch(n.label){case 0:e=t.getReader(),n.label=1;case 1:n.trys.push([1,,9,10]),n.label=2;case 2:return[4,c(e.read())];case 3:return r=n.sent(),o=r.value,r.done?[4,c(void 0)]:[3,5];case 4:return[2,n.sent()];case 5:return[4,c(o)];case 6:return[4,n.sent()];case 7:return n.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}}))}))}function Z(t){return l(null==t?void 0:t.getReader)}function tt(t,e){if(null!=t){if(G(t))return function(t,e){return new P((function(r){var n=new d;return n.add(e.schedule((function(){var o=t[k]();n.add(o.subscribe({next:function(t){n.add(e.schedule((function(){return r.next(t)})))},error:function(t){n.add(e.schedule((function(){return r.error(t)})))},complete:function(){n.add(e.schedule((function(){return r.complete()})))}}))}))),n}))}(t,e);if(J(t))return H(t,e);if(X(t))return function(t,e){return new P((function(r){return e.schedule((function(){return t.then((function(t){r.add(e.schedule((function(){r.next(t),r.add(e.schedule((function(){return r.complete()})))})))}),(function(t){r.add(e.schedule((function(){return r.error(t)})))}))}))}))}(t,e);if(W(t))return q(t,e);if(Y(t))return function(t,e){return new P((function(r){var n;return r.add(e.schedule((function(){n=t[V](),function(t,e,r,n){void 0===n&&(n=0);var o=e.schedule((function(){try{r.call(this)}catch(e){t.error(e)}}),n);t.add(o)}(r,e,(function(){var t=n.next(),e=t.value;t.done?r.complete():(r.next(e),this.schedule())}))}))),function(){return l(null==n?void 0:n.return)&&n.return()}}))}(t,e);if(Z(t))return function(t,e){return q(Q(t),e)}(t,e)}throw K(t)}function et(t,e){return e?tt(t,e):rt(t)}function rt(t){if(t instanceof P)return t;if(null!=t){if(G(t))return n=t,new P((function(t){var e=n[k]();if(l(e.subscribe))return e.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if(J(t))return nt(t);if(X(t))return r=t,new P((function(t){r.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,m)}));if(W(t))return ot(t);if(Y(t))return e=t,new P((function(t){var r,n;try{for(var i=o(e),u=i.next();!u.done;u=i.next()){var c=u.value;if(t.next(c),t.closed)return}}catch(t){r={error:t}}finally{try{u&&!u.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}t.complete()}));if(Z(t))return ot(Q(t))}var e,r,n;throw K(t)}function nt(t){return new P((function(e){for(var r=0;r<t.length&&!e.closed;r++)e.next(t[r]);e.complete()}))}function ot(t){return new P((function(e){(function(t,e){var o,i,u,c;return r(this,void 0,void 0,(function(){var r,s;return n(this,(function(n){switch(n.label){case 0:n.trys.push([0,5,6,11]),o=a(t),n.label=1;case 1:return[4,o.next()];case 2:if((i=n.sent()).done)return[3,4];if(r=i.value,e.next(r),e.closed)return[2];n.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return s=n.sent(),u={error:s},[3,11];case 6:return n.trys.push([6,,9,10]),i&&!i.done&&(c=o.return)?[4,c.call(o)]:[3,8];case 7:n.sent(),n.label=8;case 8:return[3,10];case 9:if(u)throw u.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}}))}))})(t,e).catch((function(t){return e.error(t)}))}))}function it(t,e){return e?H(t,e):nt(t)}function ut(t){return t&&l(t.schedule)}function ct(t){return ut((e=t)[e.length-1])?t.pop():void 0;var e}function st(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=ct(t);return r?H(t,r):it(t)}function at(t,e){return $((function(r,n){var o=0;r.subscribe(new T(n,(function(r){n.next(t.call(e,r,o++))})))}))}function lt(t,e,r){return void 0===r&&(r=1/0),l(e)?lt((function(r,n){return at((function(t,o){return e(r,t,n,o)}))(rt(t(r,n)))}),r):("number"==typeof e&&(r=e),$((function(e,n){return function(t,e,r,n,o,i,u,c){var s=[],a=0,l=0,f=!1,p=function(){!f||s.length||a||e.complete()},h=function(t){return a<n?d(t):s.push(t)},d=function(t){i&&e.next(t),a++;var c=!1;rt(r(t,l++)).subscribe(new T(e,(function(t){null==o||o(t),i?h(t):e.next(t)}),(function(){c=!0}),void 0,(function(){if(c)try{a--;for(var t=function(){var t=s.shift();u?e.add(u.schedule((function(){return d(t)}))):d(t)};s.length&&a<n;)t();p()}catch(t){e.error(t)}})))};return t.subscribe(new T(e,h,(function(){f=!0,p()}))),function(){null==c||c()}}(e,n,t,r)})))}function ft(){return function(t){return void 0===t&&(t=1/0),lt(U,t)}(1)}function pt(t,e,r){void 0===t&&(t=0),void 0===r&&(r=N);var n=-1;return null!=e&&(ut(e)?r=e:n=e),new P((function(e){var o,i=(o=t)instanceof Date&&!isNaN(o)?+t-r.now():t;i<0&&(i=0);var u=0;return r.schedule((function(){e.closed||(e.next(u++),0<=n?this.schedule(void 0,n):e.complete())}),i)}))}function ht(t,e){return l(e)?lt(t,e,1):lt(t,1)}function dt(t){return t<=0?function(){return B}:$((function(e,r){var n=0;e.subscribe(new T(r,(function(e){++n<=t&&(r.next(e),t<=n&&r.complete())})))}))}function yt(t,e){return e?function(r){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return ft()(it(t,ct(t)))}(e.pipe(dt(1),$((function(t,e){t.subscribe(new T(e,w))}))),r.pipe(yt(t)))}:lt((function(e,r){return t(e,r).pipe(dt(1),function(t){return at((function(){return t}))}(e))}))}var vt="object"==typeof global&&global&&global.Object===Object&&global,bt="object"==typeof self&&self&&self.Object===Object&&self,_t=vt||bt||Function("return this")(),mt=_t.Symbol,wt=Object.prototype,gt=wt.hasOwnProperty,jt=wt.toString,xt=mt?mt.toStringTag:void 0;var Ot=Object.prototype.toString;var St=mt?mt.toStringTag:void 0;function kt(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":St&&St in Object(t)?function(t){var e=gt.call(t,xt),r=t[xt];try{t[xt]=void 0;var n=!0}catch(t){}var o=jt.call(t);return n&&(e?t[xt]=r:delete t[xt]),o}(t):function(t){return Ot.call(t)}(t)}function Ut(t){return null!=t&&"object"==typeof t}var At=Array.isArray;function It(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function Pt(t){return t}function Et(t){if(!It(t))return!1;var e=kt(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}var $t,Tt=_t["__core-js_shared__"],Dt=($t=/[^.]+$/.exec(Tt&&Tt.keys&&Tt.keys.IE_PROTO||""))?"Symbol(src)_1."+$t:"";var Rt=Function.prototype.toString;var zt=/^\[object .+?Constructor\]$/,Mt=Function.prototype,Ft=Object.prototype,Lt=Mt.toString,Ct=Ft.hasOwnProperty,Nt=RegExp("^"+Lt.call(Ct).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Bt(t){return!(!It(t)||(e=t,Dt&&Dt in e))&&(Et(t)?Nt:zt).test(function(t){if(null!=t){try{return Rt.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(t));var e}function Ht(t,e){var r=function(t,e){return null==t?void 0:t[e]}(t,e);return Bt(r)?r:void 0}var Jt=Object.create,Xt=function(){function t(){}return function(e){if(!It(e))return{};if(Jt)return Jt(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}}();function Vt(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}var qt=Date.now;var Gt,Yt,Wt,Kt=function(){try{var t=Ht(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),Qt=(Gt=Kt?function(t,e){return Kt(t,"toString",{configurable:!0,enumerable:!1,value:(r=e,function(){return r}),writable:!0});var r}:Pt,Yt=0,Wt=0,function(){var t=qt(),e=16-(t-Wt);if(Wt=t,e>0){if(++Yt>=800)return arguments[0]}else Yt=0;return Gt.apply(void 0,arguments)}),Zt=/^(?:0|[1-9]\d*)$/;function te(t,e){var r=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==r||"symbol"!=r&&Zt.test(t))&&t>-1&&t%1==0&&t<e}function ee(t,e,r){"__proto__"==e&&Kt?Kt(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}function re(t,e){return t===e||t!=t&&e!=e}var ne=Object.prototype.hasOwnProperty;function oe(t,e,r){var n=t[e];ne.call(t,e)&&re(n,r)&&(void 0!==r||e in t)||ee(t,e,r)}var ie=Math.max;function ue(t,e){return Qt(function(t,e,r){return e=ie(void 0===e?t.length-1:e,0),function(){for(var n=arguments,o=-1,i=ie(n.length-e,0),u=Array(i);++o<i;)u[o]=n[e+o];o=-1;for(var c=Array(e+1);++o<e;)c[o]=n[o];return c[e]=r(u),Vt(t,this,c)}}(t,e,Pt),t+"")}function ce(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}function se(t){return null!=t&&ce(t.length)&&!Et(t)}var ae=Object.prototype;function le(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||ae)}function fe(t){return Ut(t)&&"[object Arguments]"==kt(t)}var pe=Object.prototype,he=pe.hasOwnProperty,de=pe.propertyIsEnumerable,ye=fe(function(){return arguments}())?fe:function(t){return Ut(t)&&he.call(t,"callee")&&!de.call(t,"callee")};var ve="object"==typeof exports&&exports&&!exports.nodeType&&exports,be=ve&&"object"==typeof module&&module&&!module.nodeType&&module,_e=be&&be.exports===ve?_t.Buffer:void 0,me=(_e?_e.isBuffer:void 0)||function(){return!1},we={};we["[object Float32Array]"]=we["[object Float64Array]"]=we["[object Int8Array]"]=we["[object Int16Array]"]=we["[object Int32Array]"]=we["[object Uint8Array]"]=we["[object Uint8ClampedArray]"]=we["[object Uint16Array]"]=we["[object Uint32Array]"]=!0,we["[object Arguments]"]=we["[object Array]"]=we["[object ArrayBuffer]"]=we["[object Boolean]"]=we["[object DataView]"]=we["[object Date]"]=we["[object Error]"]=we["[object Function]"]=we["[object Map]"]=we["[object Number]"]=we["[object Object]"]=we["[object RegExp]"]=we["[object Set]"]=we["[object String]"]=we["[object WeakMap]"]=!1;var ge="object"==typeof exports&&exports&&!exports.nodeType&&exports,je=ge&&"object"==typeof module&&module&&!module.nodeType&&module,xe=je&&je.exports===ge&&vt.process,Oe=function(){try{var t=je&&je.require&&je.require("util").types;return t||xe&&xe.binding&&xe.binding("util")}catch(t){}}(),Se=Oe&&Oe.isTypedArray,ke=Se?function(t){return function(e){return t(e)}}(Se):function(t){return Ut(t)&&ce(t.length)&&!!we[kt(t)]},Ue=Object.prototype.hasOwnProperty;function Ae(t,e){var r=At(t),n=!r&&ye(t),o=!r&&!n&&me(t),i=!r&&!n&&!o&&ke(t),u=r||n||o||i,c=u?function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}(t.length,String):[],s=c.length;for(var a in t)!e&&!Ue.call(t,a)||u&&("length"==a||o&&("offset"==a||"parent"==a)||i&&("buffer"==a||"byteLength"==a||"byteOffset"==a)||te(a,s))||c.push(a);return c}var Ie=Object.prototype.hasOwnProperty;function Pe(t){if(!It(t))return function(t){var e=[];if(null!=t)for(var r in Object(t))e.push(r);return e}(t);var e=le(t),r=[];for(var n in t)("constructor"!=n||!e&&Ie.call(t,n))&&r.push(n);return r}function Ee(t){return se(t)?Ae(t,!0):Pe(t)}var $e=Ht(Object,"create");var Te=Object.prototype.hasOwnProperty;var De=Object.prototype.hasOwnProperty;function Re(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function ze(t,e){for(var r=t.length;r--;)if(re(t[r][0],e))return r;return-1}Re.prototype.clear=function(){this.__data__=$e?$e(null):{},this.size=0},Re.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},Re.prototype.get=function(t){var e=this.__data__;if($e){var r=e[t];return"__lodash_hash_undefined__"===r?void 0:r}return Te.call(e,t)?e[t]:void 0},Re.prototype.has=function(t){var e=this.__data__;return $e?void 0!==e[t]:De.call(e,t)},Re.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=$e&&void 0===e?"__lodash_hash_undefined__":e,this};var Me=Array.prototype.splice;function Fe(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Fe.prototype.clear=function(){this.__data__=[],this.size=0},Fe.prototype.delete=function(t){var e=this.__data__,r=ze(e,t);return!(r<0)&&(r==e.length-1?e.pop():Me.call(e,r,1),--this.size,!0)},Fe.prototype.get=function(t){var e=this.__data__,r=ze(e,t);return r<0?void 0:e[r][1]},Fe.prototype.has=function(t){return ze(this.__data__,t)>-1},Fe.prototype.set=function(t,e){var r=this.__data__,n=ze(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this};var Le=Ht(_t,"Map");function Ce(t,e){var r=t.__data__;return function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}(e)?r["string"==typeof e?"string":"hash"]:r.map}function Ne(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Ne.prototype.clear=function(){this.size=0,this.__data__={hash:new Re,map:new(Le||Fe),string:new Re}},Ne.prototype.delete=function(t){var e=Ce(this,t).delete(t);return this.size-=e?1:0,e},Ne.prototype.get=function(t){return Ce(this,t).get(t)},Ne.prototype.has=function(t){return Ce(this,t).has(t)},Ne.prototype.set=function(t,e){var r=Ce(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this};var Be=function(t,e){return function(r){return t(e(r))}}(Object.getPrototypeOf,Object),He=Function.prototype,Je=Object.prototype,Xe=He.toString,Ve=Je.hasOwnProperty,qe=Xe.call(Object);function Ge(t){var e=this.__data__=new Fe(t);this.size=e.size}Ge.prototype.clear=function(){this.__data__=new Fe,this.size=0},Ge.prototype.delete=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r},Ge.prototype.get=function(t){return this.__data__.get(t)},Ge.prototype.has=function(t){return this.__data__.has(t)},Ge.prototype.set=function(t,e){var r=this.__data__;if(r instanceof Fe){var n=r.__data__;if(!Le||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new Ne(n)}return r.set(t,e),this.size=r.size,this};var Ye="object"==typeof exports&&exports&&!exports.nodeType&&exports,We=Ye&&"object"==typeof module&&module&&!module.nodeType&&module,Ke=We&&We.exports===Ye?_t.Buffer:void 0,Qe=Ke?Ke.allocUnsafe:void 0;var Ze=_t.Uint8Array;function tr(t,e){var r,n,o=e?(r=t.buffer,n=new r.constructor(r.byteLength),new Ze(n).set(new Ze(r)),n):t.buffer;return new t.constructor(o,t.byteOffset,t.length)}var er,rr=function(t,e,r){for(var n=-1,o=Object(t),i=r(t),u=i.length;u--;){var c=i[er?u:++n];if(!1===e(o[c],c,o))break}return t};function nr(t,e,r){(void 0!==r&&!re(t[e],r)||void 0===r&&!(e in t))&&ee(t,e,r)}function or(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}function ir(t){return function(t,e,r,n){var o=!r;r||(r={});for(var i=-1,u=e.length;++i<u;){var c=e[i],s=n?n(r[c],t[c],c,r,t):void 0;void 0===s&&(s=t[c]),o?ee(r,c,s):oe(r,c,s)}return r}(t,Ee(t))}function ur(t,e,r,n,o,i,u){var c=or(t,r),s=or(e,r),a=u.get(s);if(a)nr(t,r,a);else{var l,f=i?i(c,s,r+"",t,e,u):void 0,p=void 0===f;if(p){var h=At(s),d=!h&&me(s),y=!h&&!d&&ke(s);f=s,h||d||y?At(c)?f=c:Ut(l=c)&&se(l)?f=function(t,e){var r=-1,n=t.length;for(e||(e=Array(n));++r<n;)e[r]=t[r];return e}(c):d?(p=!1,f=function(t,e){if(e)return t.slice();var r=t.length,n=Qe?Qe(r):new t.constructor(r);return t.copy(n),n}(s,!0)):y?(p=!1,f=tr(s,!0)):f=[]:function(t){if(!Ut(t)||"[object Object]"!=kt(t))return!1;var e=Be(t);if(null===e)return!0;var r=Ve.call(e,"constructor")&&e.constructor;return"function"==typeof r&&r instanceof r&&Xe.call(r)==qe}(s)||ye(s)?(f=c,ye(c)?f=ir(c):It(c)&&!Et(c)||(f=function(t){return"function"!=typeof t.constructor||le(t)?{}:Xt(Be(t))}(s))):p=!1}p&&(u.set(s,f),o(f,s,n,i,u),u.delete(s)),nr(t,r,f)}}function cr(t,e,r,n,o){t!==e&&rr(e,(function(i,u){if(o||(o=new Ge),It(i))ur(t,e,u,r,cr,n,o);else{var c=n?n(or(t,u),i,u+"",t,e,o):void 0;void 0===c&&(c=i),nr(t,u,c)}}),Ee)}var sr,ar=(sr=function(t,e,r){cr(t,e,r)},ue((function(t,e){var r=-1,n=e.length,o=n>1?e[n-1]:void 0,i=n>2?e[2]:void 0;for(o=sr.length>3&&"function"==typeof o?(n--,o):void 0,i&&function(t,e,r){if(!It(r))return!1;var n=typeof e;return!!("number"==n?se(r)&&te(e,r.length):"string"==n&&e in r)&&re(r[e],t)}(e[0],e[1],i)&&(o=n<3?void 0:o,n=1),t=Object(t);++r<n;){var u=e[r];u&&sr(t,u,r,o)}return t})));class lr{constructor(t){this.err=t,this.errTime=new Date}}const fr={data:()=>({url:{},options:{},result:null}),format:{String(t){this.data.url=t},Object(t){!0===t._isABackup&&ar(this,t),ar(this.data,t)}},commit:{start(){return this.data},processing(t){return this._result},complete(t){this._complete=!0,this._completeUUID=t},success(t){this._result=t},error(t){this._errorList.push(new lr(t))}}};var pr,hr=new Uint8Array(16);function dr(){if(!pr&&!(pr="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return pr(hr)}var yr=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function vr(t){return"string"==typeof t&&yr.test(t)}for(var br=[],_r=0;_r<256;++_r)br.push((_r+256).toString(16).substr(1));function mr(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(br[t[e+0]]+br[t[e+1]]+br[t[e+2]]+br[t[e+3]]+"-"+br[t[e+4]]+br[t[e+5]]+"-"+br[t[e+6]]+br[t[e+7]]+"-"+br[t[e+8]]+br[t[e+9]]+"-"+br[t[e+10]]+br[t[e+11]]+br[t[e+12]]+br[t[e+13]]+br[t[e+14]]+br[t[e+15]]).toLowerCase();if(!vr(r))throw TypeError("Stringified UUID is invalid");return r}function wr(t,e,r){var n=(t=t||{}).random||(t.rng||dr)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,e){r=r||0;for(var o=0;o<16;++o)e[r+o]=n[o];return e}return mr(n)}function gr(t,e,r,n){switch(t){case 0:return e&r^~e&n;case 1:return e^r^n;case 2:return e&r^e&n^r&n;case 3:return e^r^n}}function jr(t,e){return t<<e|t>>>32-e}var xr=function(t,e,r){function n(t,n,o,i){if("string"==typeof t&&(t=function(t){t=unescape(encodeURIComponent(t));for(var e=[],r=0;r<t.length;++r)e.push(t.charCodeAt(r));return e}(t)),"string"==typeof n&&(n=function(t){if(!vr(t))throw TypeError("Invalid UUID");var e,r=new Uint8Array(16);return r[0]=(e=parseInt(t.slice(0,8),16))>>>24,r[1]=e>>>16&255,r[2]=e>>>8&255,r[3]=255&e,r[4]=(e=parseInt(t.slice(9,13),16))>>>8,r[5]=255&e,r[6]=(e=parseInt(t.slice(14,18),16))>>>8,r[7]=255&e,r[8]=(e=parseInt(t.slice(19,23),16))>>>8,r[9]=255&e,r[10]=(e=parseInt(t.slice(24,36),16))/1099511627776&255,r[11]=e/4294967296&255,r[12]=e>>>24&255,r[13]=e>>>16&255,r[14]=e>>>8&255,r[15]=255&e,r}(n)),16!==n.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var u=new Uint8Array(16+t.length);if(u.set(n),u.set(t,n.length),(u=r(u))[6]=15&u[6]|e,u[8]=63&u[8]|128,o){i=i||0;for(var c=0;c<16;++c)o[i+c]=u[c];return o}return mr(u)}try{n.name=t}catch(t){}return n.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",n.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",n}("v5",80,(function(t){var e=[1518500249,1859775393,2400959708,3395469782],r=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof t){var n=unescape(encodeURIComponent(t));t=[];for(var o=0;o<n.length;++o)t.push(n.charCodeAt(o))}else Array.isArray(t)||(t=Array.prototype.slice.call(t));t.push(128);for(var i=t.length/4+2,u=Math.ceil(i/16),c=new Array(u),s=0;s<u;++s){for(var a=new Uint32Array(16),l=0;l<16;++l)a[l]=t[64*s+4*l]<<24|t[64*s+4*l+1]<<16|t[64*s+4*l+2]<<8|t[64*s+4*l+3];c[s]=a}c[u-1][14]=8*(t.length-1)/Math.pow(2,32),c[u-1][14]=Math.floor(c[u-1][14]),c[u-1][15]=8*(t.length-1)&4294967295;for(var f=0;f<u;++f){for(var p=new Uint32Array(80),h=0;h<16;++h)p[h]=c[f][h];for(var d=16;d<80;++d)p[d]=jr(p[d-3]^p[d-8]^p[d-14]^p[d-16],1);for(var y=r[0],v=r[1],b=r[2],_=r[3],m=r[4],w=0;w<80;++w){var g=Math.floor(w/20),j=jr(y,5)+gr(g,v,b,_)+m+e[g]+p[w]>>>0;m=_,_=b,b=jr(v,30)>>>0,v=y,y=j}r[0]=r[0]+y>>>0,r[1]=r[1]+v>>>0,r[2]=r[2]+b>>>0,r[3]=r[3]+_>>>0,r[4]=r[4]+m>>>0}return[r[0]>>24&255,r[0]>>16&255,r[0]>>8&255,255&r[0],r[1]>>24&255,r[1]>>16&255,r[1]>>8&255,255&r[1],r[2]>>24&255,r[2]>>16&255,r[2]>>8&255,255&r[2],r[3]>>24&255,r[3]>>16&255,r[3]>>8&255,255&r[3],r[4]>>24&255,r[4]>>16&255,r[4]>>8&255,255&r[4]]}));class Or{_index=wr();_status="free";_createdAt=new Date;_updatedAt=new Date;_errorList=[];_result;_marks={};_complete=!1;_completeUUID;data={};constructor(t){Object.assign(this.data,fr.data()),this.$formatMessage(t)}$formatMessage(t){let e=(r=t,Object.prototype.toString.call(r).match(/(?<=\[object\s+)\S+?(?=\])/)[0]);var r;if(!(fr.format[e]instanceof Function))throw new Error("format 状态错误"+this._index);fr.format[e].apply(this,[t])}$commit(t,...e){if(!(fr.commit[t]instanceof Function))throw new Error("commit 状态错误"+this._index);{const r=fr.commit[t].apply(this,e);if(!1!==r)return this._status=t,this._updatedAt=new Date,r}}$Mark(t){this._marks[t]=this._result}$checkRepeat(t){return this._marks.hasOwnProperty(t)}$output(){return["_complete",,"_completeUUID","_index","_status","_createdAt","_updatedAt","_errorList","_result","_marks","data"].reduce(((t,e)=>(t[e]=this[e],t)),{})}}class Sr{constructor(...t){this.plugins=t,this._createPipeline()}marksPath=[];plugins=[];_aboutElementIndex=-1;_status="normal";_tasks=[];_pluginsUUID;_createUUID(t){return xr(t,xr.URL)}_createPipeline(){let t=[],e=this.plugins.reduce(((e,r)=>{let n=r.toString(),o=this._createUUID(n);return r.uuid=o,t.push(n),!1===r.$canSkip?e.push(r):e.push(ht((t=>{let e=st(t);return t.$checkRepeat(o)?e:e.pipe(r)})),at((t=>(t.$Mark(o),t)))),e}),[]);this._pluginsUUID=this._createUUID(JSON.stringify(t)),console.log(this._pluginsUUID),this.pipeline=A(...e)}apply(t){return console.log("开始流",t),et(t).pipe(at(((t,e)=>{const r=new Or(t,e);return r._mainUUID=this._pluginsUUID,this._tasks.push(r),r})),(e=t=>!(!t._complete||"complete"!==t._status||t._completeUUID!==this._pluginsUUID||(console.log("跳过一个目标"),0)),$((function(t,r){var n=!1,o=0;t.subscribe(new T(r,(function(t){return(n||(n=!e(t,o++)))&&r.next(t)})))}))),this.pipeline,at((t=>t.$commit("complete",this._pluginsUUID)))).subscribe({complete(){console.log("爬虫全部完成")}});var e}setting(){}restart(){}retry(){}about(){}report(t){}}const kr=(t,{$delay:e=200,$count:r=3})=>{return A((n=r,void 0===i&&(i=null),i=null!=i?i:n,$((function(t,e){var r=[],u=0;t.subscribe(new T(e,(function(t){var c,s,a,l,f=null;u++%i==0&&r.push([]);try{for(var p=o(r),d=p.next();!d.done;d=p.next())(b=d.value).push(t),n<=b.length&&(f=null!=f?f:[]).push(b)}catch(t){c={error:t}}finally{try{d&&!d.done&&(s=p.return)&&s.call(p)}finally{if(c)throw c.error}}if(f)try{for(var y=o(f),v=y.next();!v.done;v=y.next()){var b=v.value;h(r,b),e.next(b)}}catch(t){a={error:t}}finally{try{v&&!v.done&&(l=y.return)&&l.call(y)}finally{if(a)throw a.error}}}),(function(){var t,n;try{for(var i=o(r),u=i.next();!u.done;u=i.next()){var c=u.value;e.next(c)}}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}e.complete()}),void 0,(function(){r=null})))}))),ht((r=>et(r).pipe(lt((e=>et(t(e)))),function(t,e){void 0===e&&(e=C);var r=pt(t,e);return yt((function(){return r}))}(e)))));var n,i},Ur=t=>e=>{t=t||{};const{$delay:r=200,$count:n=3}=t;return e.pipe(kr((e=>((t,e)=>{const{returnType:r=""}=e,{url:n,options:o}=t.$commit("start");return console.log("- 爬取 ",t.$commit("start")),fetch(n,o).then((t=>function(t,e){let r=t.headers.get("content-type")||"";return t.returnType&&"auto"!==t.returnType?e?t[e]():t.json():/text|html|rtf|xml/.test(r)?t.text():/json/.test(r)?t.json():/arrayBuffer/.test(r)?t.arrayBuffer():t.buffer?t.buffer():t.blob()}(t,r))).then((e=>(t.$commit("success",e),t))).catch((e=>(t.$commit("error",e),t)))})(e,t)),{$delay:r,$count:n}))},Ar={main:Promise.resolve(!0),add(t){this.main.then((()=>Ir(t)))}},Ir=function(t){let e=document.createElement("a");e.href=URL.createObjectURL(t),e.download=t.name,e.click(),URL.revokeObjectURL(e.href),e.remove(),console.log("%c 完成","color:green")};const Pr=t=>{const{url:e,name:r}=t.data,n=function(t,e){return t instanceof File?t:t instanceof Blob?(t.name=e,t):new File([JSON.stringify(t)],e)}(t.$commit("processing"),r||e.replace(/[^\/]*?\//g,""));Ar.add(n)},Er=(t={})=>t=>{return t.pipe((e=t=>"error"!==t.$status&&t.$result,$((function(t,n){var o=0;t.subscribe(new T(n,(function(t){return e.call(r,t,o++)&&n.next(t)})))}))),at(Pr));var e,r},$r={zangodb:{root:"jsdelivr",repo:"gh/erikolson186/zangodb/",path:"dist/zangodb.min.js",type:"script"},dexie:"https://cdn.jsdelivr.net/npm/dexie@3.0.3/dist/dexie.min.js",mockjs:"https://cdn.jsdelivr.net/npm/mockjs@1.1.0/dist/mock.min.js",xlsx:"https://cdn.jsdelivr.net/npm/xlsx@0.17.0/dist/xlsx.full.min.js",lodash:"https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js",gsap:["https://cdn.jsdelivr.net/npm/gsap@3.6.1/dist/gsap.min.js","https://cdn.jsdelivr.net/npm/gsap@3.6.1/dist/ScrollTrigger.min.js"],animejs:"https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js",rxjs:"https://cdn.jsdelivr.net/npm/rxjs@7.1.0/dist/bundles/rxjs.umd.min.js"},Tr={script:t=>new Promise(((e,r)=>{let n=document.createElement("script");n.src=t,n.onload=()=>{console.log("加载完成"),n.remove(),e()},n.onerror=t=>r(t),document.body.append(n)})),esm:t=>import(t)},Dr={jsdelivr:"https://cdn.jsdelivr.net/"};let Rr,zr={scriptMap:$r,_getURL(t){let e=t;if("string"==typeof t){$r.hasOwnProperty(t)&&(e=$r[t])}return"string"==typeof e?[{url:e,type:"script"}]:e instanceof Array?e.map((t=>this._generateURLObject(t))):[this._generateURLObject(e)]},_generateURLObject:({root:t,repo:e,path:r,type:n="script"})=>({url:(Dr[t]||t)+e+r,type:n})};function Mr(t){let e=zr._getURL(t);return Promise.all(e.map((({url:t,type:e})=>(console.log(t),Tr.hasOwnProperty(e)?Tr[e](t):Promise.resolve(!0)))))}function Fr(t){let e=Rr.utils.book_new();return Object.entries(t).forEach((([t,r])=>{let n=function(t){return t.forEach((t=>{Object.entries(t).forEach((([e,r])=>{r instanceof Object&&(t[e]=JSON.stringify(r))}))})),Rr.utils.json_to_sheet(t)}(r);Rr.utils.book_append_sheet(e,n,t)})),e}function Lr(t,e,r){let{bookType:n="xlsx",bookSST:o=!0,type:i="array"}=r||{};return function(t,e,r){let n=Rr.write(t,r);return new File([n],e+"."+r.bookType)}(Fr(t),e,{bookType:n,bookSST:o,type:i})}const Cr=(t,e)=>r=>r.pipe(at((r=>{let{name:n="爬取结果",XLSXOptions:o={}}=e||{},i=r.$commit("processing");t&&(i=t(i));let u=Lr(i,n,o);return r.$commit("success",u),r})));let Nr;Cr.init=function(){return Mr("xlsx").then((()=>{Rr=window.XLSX}))};const Br={};function Hr(t){console.log(Br);let e=new Nr(t);return e.open().catch("NoSuchDatabaseError",(r=>(e.close(),e=new Nr(t),e.version(1).stores({default:"_index,createdAt"}),e.open()))).then((e=>Br[t]=e))}var Jr=Object.freeze({__proto__:null,getData:async function(t="JSpider"){return Br.hasOwnProperty(t)||await Hr(t),new Promise(((e,r)=>Br[t].table("default").toArray(e)))},setStore:t=>e=>{let{dbName:r="JSpider"}=t||{};return e.pipe(yt((t=>{t.$commit("complete",t._mainUUID);let e=t.$output();return e._isABackup=!0,et(async function(t,e){return Br.hasOwnProperty(t)||await Hr(t),Br[t].table("default").put(e,"_index")}(r,e))})))},init:function(){return Mr("dexie").then((t=>{Nr=window.Dexie}))}}),Xr=Object.freeze({__proto__:null,Request:Ur,Download:Er,ExcelHelper:Cr,Dexie:Jr});const Vr={excel:{url:"/fake/excel",type:"get",template:{"data|100":[{ID:"@increment()",name:"@cname()",description:"@csentence()",avatar:'@dataImage("64x64")',address:"@region()",province:"@province()"}]}}};function qr(t){return new Promise((e=>setTimeout((()=>e(t)),200)))}class Gr{constructor(t){this.data=t}headers={"content-type":"application/json",get(t){return this[t]}};json(){return this.data instanceof Object?this.data:JSON.parse(this.data)}blob(){return new Blob([this.data])}text(){return JSON.stringify(this.data)}}class Yr{constructor(t){this.Mock=t,window.fetch.isFake||this.fakeFetch()}fakeFetch(){const t=this;window.$fetch=window.fetch,window.fetch=function(e,r={}){let n=t.find({url:e,type:r.method||"GET"});if(n){const e=t.convert(n,{});return console.warn("mock代理中"),new Promise((t=>t(new Gr(e)))).then((t=>qr(t)))}return console.log("未使用 mockjs"),window.$fetch(...arguments).then((t=>qr(t)))}}find(t){for(var e in this.Mock.XHR.Mock._mocked){var r=this.Mock.XHR.Mock._mocked[e];if((!r.rurl||this.match(r.rurl,t.url))&&(!r.rtype||this.match(r.rtype,t.type.toLowerCase())))return r}return!1}match(t,e){return"string"===this.Mock.Util.type(t)?t===e:"regexp"===this.Mock.Util.type(t)?t.test(e):void 0}convert(t,e){return this.Mock.Util.isFunction(t.template)?t.template(e):this.Mock.XHR.Mock.mock(t.template)}}const Wr={};var Kr=Object.freeze({__proto__:null,$load:Mr,$Mock:async function(t){if(window.Mock||(await Mr("mockjs"),new Yr(window.Mock),console.warn("Mockjs 载入并代理 Ajax 中")),!Wr[t]){console.log("mock",t);let{url:e,type:r,template:n}=Vr[t];window.Mock.mock(e,r,n),Wr[t]=!0}}});var Qr=Object.freeze({__proto__:null,initPlugins:function(...t){return Promise.all(t.reduce(((t,e)=>("init"in e&&e.init instanceof Function&&t.push(e.init()),t)),[]))},createPlugin:function(t,e){let{canSkip:r=!1}=e||{};const n=e=>e.pipe(lt((e=>st(t(e)))));return n.$canSkip=r,n}});const Zr=Object.assign(Sr,{plugins:Xr,simpleCrawl:function(t){return new Sr(Ur({returnType:"blob"}),Er()).apply(t)},tools:Kr,...Qr});export default Zr;export{Zr as JSpider};
